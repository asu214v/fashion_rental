{% extends "base.html" %}
{% load static %}
{% block content %}

<div style="display:flex; gap:20px; margin-top: 20px;">

    <div style="flex:1; position:relative; max-width:500px;">
        <div id="slider-container">
            {# ç”»åƒã®æœ‰ç„¡ãƒã‚§ãƒƒã‚¯ #}
            {% if rental.images.all|length > 0 %}
                {% for img in rental.images.all %}
                    <img class="slide{% if forloop.first %} active{% endif %}" src="{{ img.image.url }}">
                {% endfor %}
            {% else %}
                <img class="slide active" src="{% static 'images/placeholder.png' %}">
            {% endif %}
        </div>

        <button id="prev" style="position:absolute; top:50%; left:10px; transform:translateY(-50%);
                                 background:rgba(0,0,0,0.5); color:white; border:none; border-radius:50%;
                                 width:40px; height:40px; cursor:pointer; z-index:10;">&#10094;</button>
        <button id="next" style="position:absolute; top:50%; right:10px; transform:translateY(-50%);
                                 background:rgba(0,0,0,0.5); color:white; border:none; border-radius:50%;
                                 width:40px; height:40px; cursor:pointer; z-index:10;">&#10095;</button>

        <div id="dots" style="text-align:center; position:absolute; bottom:10px; left:50%; transform:translateX(-50%); z-index: 100; margin-bottom: -5px;"></div>
    </div>

    <div style="flex:1;"> 
        
        <div id="item-info-content">
            <h1 style="font-size: 2em; margin-top: 0;">{{ rental.name }}</h1> 
            <p style="margin: 5px 0;"><strong>Â¥</strong> {{ rental.price|floatformat:"0" }}</p>
            
            <p style="margin-top: 20px; margin-bottom: 5px; font-weight: bold;">èª¬æ˜:</p>
            
            <div id="description-container" class="scrollable-description-box">
                <p id="description-text" class="description-text-full">
                    {{ rental.description }}
                </p>
            </div>
            
            <p style="margin: 5px 0;"><strong>å‡ºå“è€…:</strong> {{ rental.user.username }}</p>
        </div>
        
    </div>
</div>

<div style="display:flex; align-items: center; margin-top: 15px;">
    <div style="display:flex; align-items: center; margin-left: 30px;">
        <img src="{% static 'images/fav_0.png' %}" class="icon" style="height: 24px; width: 24px; margin-right: 5px; filter: grayscale(100%);">
        <span style="font-size: 1.1em; font-weight: bold;">{{ rental.heart_count|default:"0" }}</span>
    </div>

    <a href="{% url 'items:review_detail' rental.id %}" style="display:flex; align-items: center; margin-left: 90px; text-decoration: none; color: inherit;">
        <img src="{% static 'images/star.png' %}" class="icon" style="height: 24px; width: 24px; margin-right: 5px; filter: grayscale(100%);">
        <span style="font-size: 1.1em; font-weight: bold;">{{ rental.average_rating|default:"0" }}</span>
        <span style="font-size: 1.1em; font-weight: bold; margin-left: 5px;">({{ rental.review_count|default:"0" }})</span>
    </a>
</div>

<style>
/* ... ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã¨ãƒ‰ãƒƒãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ« (å¤‰æ›´ãªã—) ... */
#slider-container {
    position: relative;
    max-width: 500px;
    aspect-ratio: 1 / 1;
    overflow: hidden;
}
.slide {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    opacity: 0;
    transition: opacity 0.5s ease;
}
.slide.active {
    opacity: 1;
    z-index: 1;
}
.dot {
    height: 8px;
    width: 8px;
    margin: 0 3px;
    display: inline-block;
    border-radius: 50%;
    background: #bbb;
    cursor: pointer;
}
.dot.active {
    background: #333;
}

/* ğŸ”¥ èª¬æ˜æ–‡ã‚³ãƒ³ãƒ†ãƒŠ (ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¨ãƒªã‚¢) ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’4è¡Œåˆ†ã«ä¿®æ­£ ğŸ”¥ */
.scrollable-description-box {
    /* 1è¡Œã®é«˜ã• 1.5em * 4è¡Œ = 6em ã«è¨­å®š */
    max-height: 6em; 
    /* é«˜ã•ãŒè¶…ãˆãŸå ´åˆã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’è¨±å¯ */
    overflow-y: auto; 
    /* ã‚¨ãƒªã‚¢ã‚’åˆ†ã‹ã‚Šã‚„ã™ãã™ã‚‹ãŸã‚ã®è£…é£¾ (ç¶­æŒ) */
    border: 1px solid #ddd; 
    padding: 10px;
    border-radius: 4px;
}

/* èª¬æ˜æ–‡ã®ãƒ†ã‚­ã‚¹ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ« (ç¶­æŒ) */
.description-text-full {
    margin: 0; 
    line-height: 1.5; 
    word-break: break-all; 
}
</style>

<script>
document.addEventListener("DOMContentLoaded", () => {
    // --- ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ãƒ­ã‚¸ãƒƒã‚¯ (å¤‰æ›´ãªã—) ---
    const slides = document.querySelectorAll(".slide");
    const dotsContainer = document.getElementById("dots");
    const prevBtn = document.getElementById("prev");
    const nextBtn = document.getElementById("next");
    let currentIndex = 0;

    if (slides.length === 0) {
        prevBtn.style.display = "none";
        nextBtn.style.display = "none";
        return; 
    }

    if (slides.length <= 1) {
        prevBtn.style.display = "none";
        nextBtn.style.display = "none";
    }

    slides.forEach((_, i) => {
        const dot = document.createElement("span");
        dot.classList.add("dot");
        dotsContainer.appendChild(dot);
        dot.addEventListener("click", () => showSlide(i));
    });

    const dots = document.querySelectorAll(".dot");

    function showSlide(index) {
        slides.forEach((slide, i) => {
            slide.classList.remove("active");
            dots[i].classList.remove("active");
        });
        slides[index].classList.add("active");
        dots[index].classList.add("active");
        currentIndex = index;
    }

    if(slides.length > 1) {
        prevBtn.addEventListener("click", () => {
            const newIndex = (currentIndex === 0) ? slides.length - 1 : currentIndex - 1;
            showSlide(newIndex);
        });

        nextBtn.addEventListener("click", () => {
            const newIndex = (currentIndex === slides.length - 1) ? 0 : currentIndex + 1;
            showSlide(newIndex);
        });
    }
});
</script>

{% endblock %}