<div class="menu-header" style="position: static; padding-bottom: 0;">
    <h3 style="margin-top: 15px; margin-left: 10px; font-size: 1.2em;">絞り込み検索</h3>
</div>

<form method="get" action="{% url 'hamburger:index' %}" id="searchForm">

    <div class="form-section">
        <label for="id_keyword">キーワード検索</label>
        <input type="text" name="keyword" id="id_keyword" 
               placeholder="商品名や説明文" 
               value="{{ params.keyword|default_if_none:'' }}">
    </div>

    <div class="form-section">
        <label>タイプ</label>
        <div class="selection-buttons-container">
            {% for choice in TYPE_CHOICES %}
                <button type="button" name="type" value="{{ choice }}" 
                        class="selection-button-small {% if params.type == choice or not params.type and choice == 'すべて' %}selected{% endif %}">
                    {{ choice }}
                </button>
            {% endfor %}
        </div>
    </div>

    <div class="form-section">
        <label>性別</label>
        <div class="selection-buttons-container">
            {% for choice in SEX_CHOICES %}
                <button type="button" name="sex" value="{{ choice }}" 
                        class="selection-button-small {% if params.sex == choice or not params.sex and choice == 'すべて' %}selected{% endif %}">
                    {{ choice }}
                </button>
            {% endfor %}
        </div>
    </div>

    <div class="form-section">
        <label for="category_select">カテゴリー</label>
        <select name="category" id="category_select" 
                data-initial-value="{{ params.category|default_if_none:'すべて' }}"
                style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
            </select>
    </div>

    <div class="form-section">
        <label for="sub_category_select">サブカテゴリー</label>
        <select name="sub_category" id="sub_category_select" 
                data-initial-value="{{ params.sub_category|default_if_none:'すべて' }}"
                style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; display: none;">
            </select>
    </div>

    <div class="form-section">
        <label for="id_size_select">サイズ(-XS,S,M,L,XL-)</label>
        <div id="size_select_container" 
             data-initial-value="{{ params.size|default_if_none:'ーー' }}">
            </div>
    </div>
    
    <div class="form-section measurement-field" data-name="total_length" style="display: none;">
        <label for="id_total_length_min">着丈/総丈 (cm)</label>
        <div style="display: flex; align-items: center;">
            <input type="number" name="total_length_min" id="id_total_length_min" 
                   placeholder="下限" 
                   value="{{ params.total_length_min|default_if_none:'' }}" 
                   style="width: 50%;"> 
            <span style="margin: 0 10px;">~</span>
            <input type="number" name="total_length_max" id="id_total_length_max" 
                   placeholder="上限" 
                   value="{{ params.total_length_max|default_if_none:'' }}" 
                   style="width: 50%;">
        </div>
    </div>
    
    <div class="form-section measurement-field" data-name="body_width" style="display: none;">
        <label for="id_body_width_min">身幅 (cm)</label>
        <div style="display: flex; align-items: center;">
            <input type="number" name="body_width_min" id="id_body_width_min" 
                   placeholder="下限" 
                   value="{{ params.body_width_min|default_if_none:'' }}" 
                   style="width: 50%;"> 
            <span style="margin: 0 10px;">~</span>
            <input type="number" name="body_width_max" id="id_body_width_max" 
                   placeholder="上限" 
                   value="{{ params.body_width_max|default_if_none:'' }}" 
                   style="width: 50%;">
        </div>
    </div>

    <div class="form-section measurement-field" data-name="shoulder_width" style="display: none;">
        <label for="id_shoulder_width_min">肩幅 (cm)</label>
        <div style="display: flex; align-items: center;">
            <input type="number" name="shoulder_width_min" id="id_shoulder_width_min" 
                   placeholder="下限" 
                   value="{{ params.shoulder_width_min|default_if_none:'' }}" 
                   style="width: 50%;"> 
            <span style="margin: 0 10px;">~</span>
            <input type="number" name="shoulder_width_max" id="id_shoulder_width_max" 
                   placeholder="上限" 
                   value="{{ params.shoulder_width_max|default_if_none:'' }}" 
                   style="width: 50%;">
        </div>
    </div>

    <div class="form-section measurement-field" data-name="sleeve_length" style="display: none;">
        <label for="id_sleeve_length_min">そで丈 (cm)</label>
        <div style="display: flex; align-items: center;">
            <input type="number" name="sleeve_length_min" id="id_sleeve_length_min" 
                   placeholder="下限" 
                   value="{{ params.sleeve_length_min|default_if_none:'' }}" 
                   style="width: 50%;"> 
            <span style="margin: 0 10px;">~</span>
            <input type="number" name="sleeve_length_max" id="id_sleeve_length_max" 
                   placeholder="上限" 
                   value="{{ params.sleeve_length_max|default_if_none:'' }}" 
                   style="width: 50%;">
        </div>
    </div>

    <div class="form-section measurement-field" data-name="waist" style="display: none;">
        <label for="id_waist_min">ウエスト (cm)</label>
        <div style="display: flex; align-items: center;">
            <input type="number" name="waist_min" id="id_waist_min" 
                   placeholder="下限" 
                   value="{{ params.waist_min|default_if_none:'' }}" 
                   style="width: 50%;"> 
            <span style="margin: 0 10px;">~</span>
            <input type="number" name="waist_max" id="id_waist_max" 
                   placeholder="上限" 
                   value="{{ params.waist_max|default_if_none:'' }}" 
                   style="width: 50%;">
        </div>
    </div>
    
    <div class="form-section measurement-field" data-name="hip" style="display: none;">
        <label for="id_hip_min">ヒップ (cm)</label>
        <div style="display: flex; align-items: center;">
            <input type="number" name="hip_min" id="id_hip_min" 
                   placeholder="下限" 
                   value="{{ params.hip_min|default_if_none:'' }}" 
                   style="width: 50%;"> 
            <span style="margin: 0 10px;">~</span>
            <input type="number" name="hip_max" id="id_hip_max" 
                   placeholder="上限" 
                   value="{{ params.hip_max|default_if_none:'' }}" 
                   style="width: 50%;">
        </div>
    </div>
    
    <div class="form-section measurement-field" data-name="length" style="display: none;">
        <label for="id_length_min">丈 (cm)</label>
        <div style="display: flex; align-items: center;">
            <input type="number" name="length_min" id="id_length_min" 
                   placeholder="下限" 
                   value="{{ params.length_min|default_if_none:'' }}" 
                   style="width: 50%;"> 
            <span style="margin: 0 10px;">~</span>
            <input type="number" name="length_max" id="id_length_max" 
                   placeholder="上限" 
                   value="{{ params.length_max|default_if_none:'' }}" 
                   style="width: 50%;">
        </div>
    </div>

    <div class="form-section measurement-field" data-name="rise" style="display: none;">
        <label for="id_rise_min">股上 (cm)</label>
        <div style="display: flex; align-items: center;">
            <input type="number" name="rise_min" id="id_rise_min" 
                   placeholder="下限" 
                   value="{{ params.rise_min|default_if_none:'' }}" 
                   style="width: 50%;"> 
            <span style="margin: 0 10px;">~</span>
            <input type="number" name="rise_max" id="id_rise_max" 
                   placeholder="上限" 
                   value="{{ params.rise_max|default_if_none:'' }}" 
                   style="width: 50%;">
        </div>
    </div>
    
    <div class="form-section measurement-field" data-name="inseam" style="display: none;">
        <label for="id_inseam_min">股下 (cm)</label>
        <div style="display: flex; align-items: center;">
            <input type="number" name="inseam_min" id="id_inseam_min" 
                   placeholder="下限" 
                   value="{{ params.inseam_min|default_if_none:'' }}" 
                   style="width: 50%;"> 
            <span style="margin: 0 10px;">~</span>
            <input type="number" name="inseam_max" id="id_inseam_max" 
                   placeholder="上限" 
                   value="{{ params.inseam_max|default_if_none:'' }}" 
                   style="width: 50%;">
        </div>
    </div>
    
    <div class="form-section measurement-field" data-name="thigh" style="display: none;">
        <label for="id_thigh_min">もも回り (cm)</label>
        <div style="display: flex; align-items: center;">
            <input type="number" name="thigh_min" id="id_thigh_min" 
                   placeholder="下限" 
                   value="{{ params.thigh_min|default_if_none:'' }}" 
                   style="width: 50%;"> 
            <span style="margin: 0 10px;">~</span>
            <input type="number" name="thigh_max" id="id_thigh_max" 
                   placeholder="上限" 
                   value="{{ params.thigh_max|default_if_none:'' }}" 
                   style="width: 50%;">
        </div>
    </div>
    
    <div class="form-section measurement-field" data-name="hem" style="display: none;">
        <label for="id_hem_min">すそ回り (cm)</label>
        <div style="display: flex; align-items: center;">
            <input type="number" name="hem_min" id="id_hem_min" 
                   placeholder="下限" 
                   value="{{ params.hem_min|default_if_none:'' }}" 
                   style="width: 50%;"> 
            <span style="margin: 0 10px;">~</span>
            <input type="number" name="hem_max" id="id_hem_max" 
                   placeholder="上限" 
                   value="{{ params.hem_max|default_if_none:'' }}" 
                   style="width: 50%;">
        </div>
    </div>

    <div class="form-section measurement-field" data-name="shoe_size" style="display: none;">
        <label for="id_shoe_size_min">靴サイズ (cm)</label>
        <div style="display: flex; align-items: center;">
            <input type="number" name="shoe_size_min" id="id_shoe_size_min" 
                   placeholder="下限" 
                   value="{{ params.shoe_size_min|default_if_none:'' }}" 
                   style="width: 50%;"> 
            <span style="margin: 0 10px;">~</span>
            <input type="number" name="shoe_size_max" id="id_shoe_size_max" 
                   placeholder="上限" 
                   value="{{ params.shoe_size_max|default_if_none:'' }}" 
                   style="width: 50%;">
        </div>
    </div>

    <div class="form-section">
        <label for="id_brand">ブランド</label>
        <input type="text" name="brand" id="id_brand" 
            placeholder="ブランド名を入力" 
            value="{{ params.brand|default_if_none:'' }}">
    </div>

    <div class="form-section color-selection-grid">
        <label>色</label>
        <div class="color-grid-container">
            {% for color_name, color_code in COLOR_MAP.items %}
                <button type="button" name="color" value="{{ color_name }}" 
                        class="color-option-btn {% if params.color == color_name or not params.color and color_name == 'すべて' %}selected{% endif %}"
                        style="background-color: {{ color_code }}; color: {% if color_name == 'ホワイト' or color_name == 'イエロー' %}black{% else %}white{% endif %}; border: {% if color_name == 'ホワイト' or color_name == 'イエロー' or color_name == 'すべて' %}1px solid #ccc{% else %}none{% endif %};">
                    {{ color_name }}
                </button>
            {% endfor %}
        </div>
    </div>

    <div class="form-section price-section">
            <label>価格帯</label>
            <div style="display: flex; align-items: center;">
                <label for="min_price" style="flex-shrink: 0; width: auto; margin-right: 5px;">¥</label>
                <input type="number" name="min_price" id="min_price" 
                        placeholder="0" 
                        value="{{ params.min_price|default_if_none:'' }}" 
                        style="width: 50%;"
                        > <span style="margin: 0 10px;">~</span>
                <label for="max_price" style="flex-shrink: 0; width: auto; margin-right: 5px;">¥</label>
                <input type="number" name="max_price" id="max_price" 
                        placeholder="上限なし" 
                        value="{{ params.max_price|default_if_none:'' }}" 
                        style="width: 50%;"
                        > </div>
    <div id="priceError" style="color: red; font-size: 0.9em; margin-top: 5px; display: none;"></div>
        </div>

    <div class="form-actions">
        <button type="submit" class="search-submit-btn">検索</button>
        <button type="button" class="search-reset-btn">リセット</button> 
    </div>
</form>

<div class="search-history-section">
    <h4 style="margin-bottom: 5px;">検索履歴</h4>
    {% if search_history %}
        {% for term in search_history %}
            <a href="{% url 'hamburger:index' %}?keyword={{ term }}" class="history-tag">
                {{ term }}
            </a>
        {% endfor %}
    {% else %}
        <p class="no-history">履歴はありません。</p>
    {% endif %}
</div>